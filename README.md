# Проект: Napoleon IT Sales агент для сервиса "Отзывы" 

Система состоит из следующих серверов:
* MongoDB
* Сервер бизнес логики
* Сервер обработки email
* Сервер ТГ бота

Коммуникация между серверами осуществляется через MongoDB.

Т.к. средств для запуска машины c GPU в Яндекс облаке было недостаточно. LLM запущена на собственном сервере.
Сервер бизнес логики общается с LLM через MongoDB соединение с использованием публичного IP адреса.

## О чем клиент может поговорить с Sales агентом

* Попросить перестать спамить
* Запросить презентацию
* Запросить демонстрацию
* Переадресовать агента на другой контакт
* Попросить таймаут в общении (агент должен напомнить если таймаут вышел но клиент о нас забыл)
* Разговаривать о возможностях сервиса Napoleon IT Отзывы

## Комментарий по поводу общения через электронную почту

В текущей реализации, при ответе на письма агента нужно удалять историю общения иначе агент может не точно отвечать.

Это будет исправлено в будущей версии.

## Комментарий по поводу Телеграмма как какнала коммуникации

Телеграм предоставляет два варианта API:
* API который предоставляет доступ ко всем функциям Телеграмма которые может совершать пользователь из приложения
* API для телеграмм бота

Телеграмм бот имеет ограничения. Самое главное ограничение - бот не может сам инициировать общение с абонентом. Из-за этого ограничения, абонент сам должен начать общение с ботом, что не приемлемо для Sales агента.

Мы реализовали доступ к телеграмм через полный API (см. src/services/tg_processor/tg_server), но **Телеграмм заблокировал** наши демонстрационные аккаунты. Поэтому в рамках хакатона мы реализовали вариант API для бота (src/services/tg_processor/bot.py).
Из-за этого потенциальному "клиенту" необходимо самостоятельно найти бота по https://t.me/NapaleonIT_Sales_Agent_test_bot или @NapaleonIT_Sales_Agent_test_bot и выдать комманду /start.

Для перезапуска общения пользователь всегда может отправить команду /start.

В варианте с email каналом коммуникации, система сама отправляет инициирующее сообщение.

# Как запустить систему
Каждый сервер системы запускается в собственном Docker контейере. Управдение контейнерами реализовано через docker-compose.

Для запуска системы перейдите в папку src/services и выполните: ```docker compose -d up```

Для остановки системы: ```docker compose down```

Для первоначального старта системы, в БД необходимо записать информацию об email аккаунте и создать .env файл:
* Запустите контейнеры и убедитесь что Mongo контейнер работает (```docker ps```)
* Отредактируйте src/services/init_data.json
* Из папки src/services запустите ```docker run -it -v ./:/my --network=host mail_worker bash``` Откроется консоль в свежезапущенном контейнере
* ```cd /my && python3 populate_data.py```
* Отключитесь от контейнер Ctrl-d

Для мониторинга системы используются логи в докере: ```docker logs app_logic```

## Как добавить новый контакт чтобы агент начал общение
* Из папки src/services запустите ```docker run -it -v ./:/my --network=host mail_worker bash``` Откроется консоль в свежезапущенном контейнере
* ```cd /my/app_logic && python3 client_utils.py```

Утилита выдаст Help. С помощью этой утилиты можно создавать новые контакты чтобы сервис начал общение, просматривать текущий статус клиента с историей общения, перезапустить общение с клиентом.
